<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow - Professional Pomodoro Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            flex: 1;
        }

        .timer-section {
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .timer-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .timer-display {
            font-size: 4em;
            font-weight: 300;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timer-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .timer-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .setting-group label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .setting-group input {
            width: 80px;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 4px;
            text-align: center;
            font-size: 1em;
        }

        .tasks-section {
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .tasks-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success-color), var(--accent-color));
        }

        .task-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1em;
        }

        .task-input input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .task-list {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .task-item {
            background: var(--background);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--success-color);
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-left-color: var(--accent-color);
        }

        .task-text {
            flex: 1;
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .progress-section {
            grid-column: 1 / -1;
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--background);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid var(--primary-color);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .progress-bar {
            background: var(--border);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .export-import {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .phase-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 500;
        }

        .phase-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
        }

        .phase-work {
            background: var(--primary-color);
        }

        .phase-break {
            background: var(--success-color);
        }

        .phase-long-break {
            background: var(--accent-color);
        }

        .sound-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }

        .sound-controls label {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .sound-controls input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .timer-display {
                font-size: 3em;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçÖ FocusFlow</h1>
            <p>Professional Pomodoro Timer with Advanced Task Management</p>
        </div>

        <div class="main-content">
            <div class="timer-section">
                <div class="phase-indicator">
                    <div class="phase-icon phase-work" id="phaseIcon">üçÖ</div>
                    <span id="phaseText">Work Session</span>
                </div>
                
                <div class="timer-display" id="timerDisplay">25:00</div>
                
                <div class="timer-controls">
                    <button class="btn btn-primary" id="startBtn">‚ñ∂Ô∏è Start</button>
                    <button class="btn btn-warning" id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
                    <button class="btn btn-danger" id="resetBtn">üîÑ Reset</button>
                    <button class="btn btn-success" id="skipBtn">‚è≠Ô∏è Skip</button>
                </div>

                <div class="timer-settings">
                    <div class="setting-group">
                        <label for="workTime">Work (min)</label>
                        <input type="number" id="workTime" value="25" min="1" max="60">
                    </div>
                    <div class="setting-group">
                        <label for="breakTime">Break (min)</label>
                        <input type="number" id="breakTime" value="5" min="1" max="30">
                    </div>
                    <div class="setting-group">
                        <label for="longBreakTime">Long Break (min)</label>
                        <input type="number" id="longBreakTime" value="15" min="1" max="60">
                    </div>
                    <div class="setting-group">
                        <label for="sessionsUntilLongBreak">Sessions Until Long Break</label>
                        <input type="number" id="sessionsUntilLongBreak" value="4" min="2" max="10">
                    </div>
                </div>

                <div class="sound-controls">
                    <label for="soundEnabled">
                        <input type="checkbox" id="soundEnabled" checked>
                        Enable Sound Notifications
                    </label>
                </div>
            </div>

            <div class="tasks-section">
                <h2>üìã Task Management</h2>
                
                <div class="task-input">
                    <input type="text" id="taskInput" placeholder="Enter a new task..." maxlength="100">
                    <button class="btn btn-primary" id="addTaskBtn">‚ûï Add Task</button>
                </div>

                <div class="task-list" id="taskList">
                    <!-- Tasks will be dynamically added here -->
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h2>üìä Progress Analytics</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="completedSessions">0</div>
                    <div class="stat-label">Completed Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalFocusTime">0h 0m</div>
                    <div class="stat-label">Total Focus Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">Completed Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <h3>Daily Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="dailyProgress" style="width: 0%"></div>
                </div>
                <p style="text-align: center; margin-top: 5px; color: var(--text-secondary);">
                    <span id="dailySessionsText">0 of 8 sessions completed today</span>
                </p>
            </div>

            <div class="export-import">
                <button class="btn btn-primary" id="exportBtn">üì§ Export Data</button>
                <label for="importFile" class="btn btn-secondary" style="background: var(--text-secondary); color: white;">
                    üì• Import Data
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </label>
                <button class="btn btn-danger" id="clearDataBtn">üóëÔ∏è Clear All Data</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        class PomodoroTimer {
            constructor() {
                this.timer = null;
                this.timeLeft = 25 * 60; // 25 minutes in seconds
                this.isRunning = false;
                this.currentPhase = 'work'; // 'work', 'break', 'longBreak'
                this.sessionCount = 0;
                this.currentTaskId = null;
                
                // Settings
                this.settings = {
                    workTime: 25,
                    breakTime: 5,
                    longBreakTime: 15,
                    sessionsUntilLongBreak: 4,
                    soundEnabled: true
                };

                // Data storage
                this.data = {
                    tasks: [],
                    sessions: [],
                    stats: {
                        totalSessions: 0,
                        totalFocusTime: 0,
                        completedTasks: 0,
                        currentStreak: 0,
                        dailySessions: 0,
                        lastSessionDate: null
                    }
                };

                this.initializeElements();
                this.bindEvents();
                this.loadSettings();
                this.updateDisplay();
                this.updateStats();
                this.createAudioContext();
            }

            initializeElements() {
                // Timer elements
                this.timerDisplay = document.getElementById('timerDisplay');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.skipBtn = document.getElementById('skipBtn');
                this.phaseIcon = document.getElementById('phaseIcon');
                this.phaseText = document.getElementById('phaseText');

                // Settings elements
                this.workTimeInput = document.getElementById('workTime');
                this.breakTimeInput = document.getElementById('breakTime');
                this.longBreakTimeInput = document.getElementById('longBreakTime');
                this.sessionsUntilLongBreakInput = document.getElementById('sessionsUntilLongBreak');
                this.soundEnabledInput = document.getElementById('soundEnabled');

                // Task elements
                this.taskInput = document.getElementById('taskInput');
                this.addTaskBtn = document.getElementById('addTaskBtn');
                this.taskList = document.getElementById('taskList');

                // Stats elements
                this.completedSessionsEl = document.getElementById('completedSessions');
                this.totalFocusTimeEl = document.getElementById('totalFocusTime');
                this.completedTasksEl = document.getElementById('completedTasks');
                this.currentStreakEl = document.getElementById('currentStreak');
                this.dailyProgressEl = document.getElementById('dailyProgress');
                this.dailySessionsTextEl = document.getElementById('dailySessionsText');

                // Export/Import elements
                this.exportBtn = document.getElementById('exportBtn');
                this.importFile = document.getElementById('importFile');
                this.clearDataBtn = document.getElementById('clearDataBtn');

                // Notification
                this.notification = document.getElementById('notification');
            }

            bindEvents() {
                // Timer controls
                this.startBtn.addEventListener('click', () => this.startTimer());
                this.pauseBtn.addEventListener('click', () => this.pauseTimer());
                this.resetBtn.addEventListener('click', () => this.resetTimer());
                this.skipBtn.addEventListener('click', () => this.skipPhase());

                // Settings
                this.workTimeInput.addEventListener('change', () => this.updateSettings());
                this.breakTimeInput.addEventListener('change', () => this.updateSettings());
                this.longBreakTimeInput.addEventListener('change', () => this.updateSettings());
                this.sessionsUntilLongBreakInput.addEventListener('change', () => this.updateSettings());
                this.soundEnabledInput.addEventListener('change', () => this.updateSettings());

                // Tasks
                this.addTaskBtn.addEventListener('click', () => this.addTask());
                this.taskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTask();
                });

                // Export/Import
                this.exportBtn.addEventListener('click', () => this.exportData());
                this.importFile.addEventListener('change', (e) => this.importData(e));
                this.clearDataBtn.addEventListener('click', () => this.clearAllData());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case ' ':
                                e.preventDefault();
                                this.isRunning ? this.pauseTimer() : this.startTimer();
                                break;
                            case 'r':
                                e.preventDefault();
                                this.resetTimer();
                                break;
                        }
                    }
                });
            }

            createAudioContext() {
                // Create audio context for notifications
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            playNotificationSound() {
                if (!this.settings.soundEnabled) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + 0.5);
            }

            startTimer() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.startBtn.disabled = true;
                this.pauseBtn.disabled = false;
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateDisplay();
                    
                    if (this.timeLeft <= 0) {
                        this.completePhase();
                    }
                }, 1000);
            }

            pauseTimer() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                
                clearInterval(this.timer);
            }

            resetTimer() {
                this.pauseTimer();
                this.timeLeft = this.getCurrentPhaseTime() * 60;
                this.updateDisplay();
            }

            skipPhase() {
                this.completePhase();
            }

            completePhase() {
                this.pauseTimer();
                this.playNotificationSound();
                
                if (this.currentPhase === 'work') {
                    this.sessionCount++;
                    this.data.stats.totalSessions++;
                    this.data.stats.totalFocusTime += this.settings.workTime;
                    this.data.stats.dailySessions++;
                    this.data.stats.lastSessionDate = new Date().toDateString();
                    
                    // Record session
                    this.data.sessions.push({
                        date: new Date().toISOString(),
                        duration: this.settings.workTime,
                        taskId: this.currentTaskId,
                        completed: true
                    });
                    
                    // Update current streak
                    this.data.stats.currentStreak++;
                    
                    this.showNotification('Work session completed! Great job! üéâ', 'success');
                    
                    // Move to break
                    if (this.sessionCount % this.settings.sessionsUntilLongBreak === 0) {
                        this.currentPhase = 'longBreak';
                    } else {
                        this.currentPhase = 'break';
                    }
                } else {
                    this.showNotification('Break time over! Ready for another session? üí™', 'warning');
                    this.currentPhase = 'work';
                }
                
                this.timeLeft = this.getCurrentPhaseTime() * 60;
                this.updateDisplay();
                this.updateStats();
            }

            getCurrentPhaseTime() {
                switch(this.currentPhase) {
                    case 'work': return this.settings.workTime;
                    case 'break': return this.settings.breakTime;
                    case 'longBreak': return this.settings.longBreakTime;
                    default: return this.settings.workTime;
                }
            }

            updateDisplay() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                this.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update phase indicator
                const phaseConfig = {
                    work: { icon: 'üçÖ', text: 'Work Session', class: 'phase-work' },
                    break: { icon: '‚òï', text: 'Short Break', class: 'phase-break' },
                    longBreak: { icon: 'üèñÔ∏è', text: 'Long Break', class: 'phase-long-break' }
                };
                
                const config = phaseConfig[this.currentPhase];
                this.phaseIcon.textContent = config.icon;
                this.phaseText.textContent = config.text;
                this.phaseIcon.className = `phase-icon ${config.class}`;
                
                // Update document title
                document.title = `${this.timerDisplay.textContent} - ${config.text} - FocusFlow`;
            }

            updateSettings() {
                this.settings = {
                    workTime: parseInt(this.workTimeInput.value),
                    breakTime: parseInt(this.breakTimeInput.value),
                    longBreakTime: parseInt(this.longBreakTimeInput.value),
                    sessionsUntilLongBreak: parseInt(this.sessionsUntilLongBreakInput.value),
                    soundEnabled: this.soundEnabledInput.checked
                };
                
                if (!this.isRunning) {
                    this.timeLeft = this.getCurrentPhaseTime() * 60;
                    this.updateDisplay();
                }
            }

            loadSettings() {
                this.workTimeInput.value = this.settings.workTime;
                this.breakTimeInput.value = this.settings.breakTime;
                this.longBreakTimeInput.value = this.settings.longBreakTime;
                this.sessionsUntilLongBreakInput.value = this.settings.sessionsUntilLongBreak;
                this.soundEnabledInput.checked = this.settings.soundEnabled;
            }

            addTask() {
                const taskText = this.taskInput.value.trim();
                if (!taskText) return;
                
                const task = {
                    id: Date.now(),
                    text: taskText,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    completedAt: null,
                    pomodoroCount: 0
                };
                
                this.data.tasks.push(task);
                this.taskInput.value = '';
                this.renderTasks();
                this.showNotification('Task added successfully! üìù', 'success');
            }

            renderTasks() {
                this.taskList.innerHTML = '';
                
                this.data.tasks.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = `task-item ${task.completed ? 'completed' : ''} ${task.id === this.currentTaskId ? 'active' : ''}`;
                    
                    taskEl.innerHTML = `
                        <div class="task-text">${task.text}</div>
                        <div class="task-actions">
                            <button onclick="pomodoro.toggleTask(${task.id})" 
                                    style="background: ${task.completed ? '#10b981' : '#f59e0b'}; color: white;">
                                ${task.completed ? '‚úì' : '‚óã'}
                            </button>
                            <button onclick="pomodoro.setActiveTask(${task.id})" 
                                    style="background: #2563eb; color: white;"
                                    ${task.id === this.currentTaskId ? 'disabled' : ''}>
                                üéØ
                            </button>
                            <button onclick="pomodoro.deleteTask(${task.id})" 
                                    style="background: #ef4444; color: white;">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                    
                    this.taskList.appendChild(taskEl);
                });
            }

            toggleTask(taskId) {
                const task = this.data.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                task.completed = !task.completed;
                task.completedAt = task.completed ? new Date().toISOString() : null;
                
                if (task.completed) {
                    this.data.stats.completedTasks++;
                    this.showNotification('Task completed! Well done! üéâ', 'success');
                    
                    // If this was the active task, clear it
                    if (this.currentTaskId === taskId) {
                        this.currentTaskId = null;
                    }
                } else {
                    this.data.stats.completedTasks = Math.max(0, this.data.stats.completedTasks - 1);
                }
                
                this.renderTasks();
                this.updateStats();
            }

            setActiveTask(taskId) {
                this.currentTaskId = taskId;
                this.renderTasks();
                const task = this.data.tasks.find(t => t.id === taskId);
                this.showNotification(`Active task set: ${task.text} üéØ`, 'success');
            }

            deleteTask(taskId) {
                if (confirm('Are you sure you want to delete this task?')) {
                    const taskIndex = this.data.tasks.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        const task = this.data.tasks[taskIndex];
                        if (task.completed) {
                            this.data.stats.completedTasks = Math.max(0, this.data.stats.completedTasks - 1);
                        }
                        
                        this.data.tasks.splice(taskIndex, 1);
                        
                        if (this.currentTaskId === taskId) {
                            this.currentTaskId = null;
                        }
                        
                        this.renderTasks();
                        this.updateStats();
                        this.showNotification('Task deleted successfully! üóëÔ∏è', 'warning');
                    }
                }
            }

            updateStats() {
                // Check if it's a new day
                const today = new Date().toDateString();
                if (this.data.stats.lastSessionDate !== today) {
                    this.data.stats.dailySessions = 0;
                }
                
                // Update stat displays
                this.completedSessionsEl.textContent = this.data.stats.totalSessions;
                
                const hours = Math.floor(this.data.stats.totalFocusTime / 60);
                const minutes = this.data.stats.totalFocusTime % 60;
                this.totalFocusTimeEl.textContent = `${hours}h ${minutes}m`;
                
                this.completedTasksEl.textContent = this.data.stats.completedTasks;
                this.currentStreakEl.textContent = this.data.stats.currentStreak;
                
                // Update daily progress
                const dailyGoal = 8; // 8 pomodoro sessions per day
                const progressPercentage = Math.min(100, (this.data.stats.dailySessions / dailyGoal) * 100);
                this.dailyProgressEl.style.width = progressPercentage + '%';
                this.dailySessionsTextEl.textContent = `${this.data.stats.dailySessions} of ${dailyGoal} sessions completed today`;
            }

            showNotification(message, type = 'success') {
                this.notification.textContent = message;
                this.notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    this.notification.classList.remove('show');
                }, 3000);
            }

            exportData() {
                const dataToExport = {
                    settings: this.settings,
                    data: this.data,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `focusflow-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                this.showNotification('Data exported successfully! üì§', 'success');
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate data structure
                        if (!importedData.data || !importedData.settings) {
                            throw new Error('Invalid data format');
                        }
                        
                        // Merge imported data
                        this.data = {
                            ...this.data,
                            ...importedData.data
                        };
                        
                        this.settings = {
                            ...this.settings,
                            ...importedData.settings
                        };
                        
                        // Update UI
                        this.loadSettings();
                        this.renderTasks();
                        this.updateStats();
                        this.resetTimer();
                        
                        this.showNotification('Data imported successfully! üì•', 'success');
                    } catch (error) {
                        this.showNotification('Error importing data. Please check the file format. ‚ùå', 'error');
                        console.error('Import error:', error);
                    }
                };
                
                reader.readAsText(file);
                event.target.value = ''; // Reset file input
            }

            clearAllData() {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    this.data = {
                        tasks: [],
                        sessions: [],
                        stats: {
                            totalSessions: 0,
                            totalFocusTime: 0,
                            completedTasks: 0,
                            currentStreak: 0,
                            dailySessions: 0,
                            lastSessionDate: null
                        }
                    };
                    
                    this.currentTaskId = null;
                    this.sessionCount = 0;
                    
                    this.renderTasks();
                    this.updateStats();
                    this.resetTimer();
                    
                    this.showNotification('All data cleared successfully! üóëÔ∏è', 'warning');
                }
            }

            // Advanced analytics method
            getAnalytics() {
                const analytics = {
                    productivity: {
                        averageSessionsPerDay: this.calculateAverageSessionsPerDay(),
                        mostProductiveTimeOfDay: this.getMostProductiveTimeOfDay(),
                        taskCompletionRate: this.getTaskCompletionRate(),
                        focusTimeDistribution: this.getFocusTimeDistribution()
                    },
                    trends: {
                        weeklyProgress: this.getWeeklyProgress(),
                        streakHistory: this.getStreakHistory(),
                        taskCategories: this.getTaskCategories()
                    }
                };
                
                return analytics;
            }

            calculateAverageSessionsPerDay() {
                if (this.data.sessions.length === 0) return 0;
                
                const dates = [...new Set(this.data.sessions.map(s => s.date.split('T')[0]))];
                return this.data.sessions.length / dates.length;
            }

            getMostProductiveTimeOfDay() {
                const hourCounts = {};
                this.data.sessions.forEach(session => {
                    const hour = new Date(session.date).getHours();
                    hourCounts[hour] = (hourCounts[hour] || 0) + 1;
                });
                
                const maxHour = Object.keys(hourCounts).reduce((a, b) => 
                    hourCounts[a] > hourCounts[b] ? a : b, 0);
                
                return `${maxHour}:00`;
            }

            getTaskCompletionRate() {
                if (this.data.tasks.length === 0) return 0;
                return (this.data.stats.completedTasks / this.data.tasks.length) * 100;
            }

            getFocusTimeDistribution() {
                const today = new Date();
                const last7Days = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const daysSessions = this.data.sessions.filter(s => 
                        s.date.split('T')[0] === dateStr
                    );
                    
                    last7Days.push({
                        date: dateStr,
                        sessions: daysSessions.length,
                        focusTime: daysSessions.reduce((sum, s) => sum + s.duration, 0)
                    });
                }
                
                return last7Days;
            }

            getWeeklyProgress() {
                const weeklyData = this.getFocusTimeDistribution();
                const totalWeeklyTime = weeklyData.reduce((sum, day) => sum + day.focusTime, 0);
                const weeklyGoal = 8 * 25 * 7; // 8 sessions √ó 25 minutes √ó 7 days
                
                return {
                    completed: totalWeeklyTime,
                    goal: weeklyGoal,
                    percentage: Math.min(100, (totalWeeklyTime / weeklyGoal) * 100)
                };
            }

            getStreakHistory() {
                // Implementation for streak tracking would go here
                return {
                    current: this.data.stats.currentStreak,
                    longest: this.data.stats.longestStreak || 0,
                    history: [] // Array of daily streak data
                };
            }

            getTaskCategories() {
                // Simple categorization based on keywords
                const categories = {
                    work: ['work', 'meeting', 'project', 'code', 'development'],
                    study: ['study', 'learn', 'read', 'course', 'research'],
                    personal: ['personal', 'exercise', 'health', 'hobby'],
                    other: []
                };
                
                const tasksByCategory = {
                    work: 0,
                    study: 0,
                    personal: 0,
                    other: 0
                };
                
                this.data.tasks.forEach(task => {
                    const taskLower = task.text.toLowerCase();
                    let categorized = false;
                    
                    for (const [category, keywords] of Object.entries(categories)) {
                        if (category === 'other') continue;
                        
                        if (keywords.some(keyword => taskLower.includes(keyword))) {
                            tasksByCategory[category]++;
                            categorized = true;
                            break;
                        }
                    }
                    
                    if (!categorized) {
                        tasksByCategory.other++;
                    }
                });
                
                return tasksByCategory;
            }

            // Keyboard shortcuts help
            showKeyboardShortcuts() {
                const shortcuts = [
                    'Ctrl/Cmd + Space: Start/Pause timer',
                    'Ctrl/Cmd + R: Reset timer',
                    'Enter: Add task (when input focused)',
                    'Ctrl/Cmd + E: Export data',
                    'Ctrl/Cmd + S: Skip phase'
                ];
                
                alert('Keyboard Shortcuts:\n\n' + shortcuts.join('\n'));
            }

            // Method to get motivational quotes
            getMotivationalQuote() {
                const quotes = [
                    "The way to get started is to quit talking and begin doing. - Walt Disney",
                    "Focus on being productive instead of busy. - Tim Ferriss",
                    "It is during our darkest moments that we must focus to see the light. - Aristotle",
                    "Concentrate all your thoughts upon the work at hand. - Alexander Graham Bell",
                    "The successful warrior is the average man with laser-like focus. - Bruce Lee",
                    "Where focus goes, energy flows and results show. - Tony Robbins",
                    "Success is where preparation and opportunity meet. - Bobby Unser",
                    "You can do two things at once, but you can't focus effectively on two things at once. - Gary Keller"
                ];
                
                return quotes[Math.floor(Math.random() * quotes.length)];
            }
        }

        // Initialize the Pomodoro Timer
        const pomodoro = new PomodoroTimer();

        // Add some sample tasks for demonstration
        setTimeout(() => {
            const sampleTasks = [
                'Review project requirements',
                'Implement user authentication',
                'Write unit tests',
                'Update documentation',
                'Code review for team member'
            ];
            
            if (pomodoro.data.tasks.length === 0) {
                sampleTasks.forEach(taskText => {
                    pomodoro.data.tasks.push({
                        id: Date.now() + Math.random(),
                        text: taskText,
                        completed: false,
                        createdAt: new Date().toISOString(),
                        completedAt: null,
                        pomodoroCount: 0
                    });
                });
                pomodoro.renderTasks();
            }
        }, 1000);

        // Service Worker registration for offline support (if needed)
        if ('serviceWorker' in navigator) {
            // Service worker registration would go here for PWA functionality
        }

        // Add favicon change based on timer state
        function updateFavicon() {
            const favicon = document.querySelector('link[rel="icon"]') || document.createElement('link');
            favicon.rel = 'icon';
            favicon.href = `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">${pomodoro.currentPhase === 'work' ? 'üçÖ' : '‚òï'}</text></svg>`;
            document.head.appendChild(favicon);
        }

        // Update favicon every second
        setInterval(updateFavicon, 1000);

        // Add visibility change handling for better performance
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Tab is hidden, reduce update frequency if needed
            } else {
                // Tab is visible, ensure display is updated
                pomodoro.updateDisplay();
                pomodoro.updateStats();
            }
        });

        // Add window beforeunload handler to warn about ongoing sessions
        window.addEventListener('beforeunload', (e) => {
            if (pomodoro.isRunning) {
                e.preventDefault();
                e.returnValue = 'You have an active Pomodoro session. Are you sure you want to leave?';
            }
        });

        // Add right-click context menu prevention on important elements
        document.addEventListener('contextmenu', (e) => {
            if (e.target.closest('.timer-display') || e.target.closest('.btn')) {
                e.preventDefault();
            }
        });

        // Add drag and drop functionality for task reordering
        let draggedTask = null;

        document.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('task-item')) {
                draggedTask = e.target;
                e.target.style.opacity = '0.5';
            }
        });

        document.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('task-item')) {
                e.target.style.opacity = '';
                draggedTask = null;
            }
        });

        document.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            if (draggedTask && e.target.classList.contains('task-item')) {
                const taskList = document.getElementById('taskList');
                const draggedIndex = Array.from(taskList.children).indexOf(draggedTask);
                const targetIndex = Array.from(taskList.children).indexOf(e.target);
                
                if (draggedIndex !== targetIndex) {
                    // Reorder tasks in data
                    const draggedTaskData = pomodoro.data.tasks[draggedIndex];
                    pomodoro.data.tasks.splice(draggedIndex, 1);
                    pomodoro.data.tasks.splice(targetIndex, 0, draggedTaskData);
                    
                    // Re-render tasks
                    pomodoro.renderTasks();
                    pomodoro.showNotification('Task order updated! üîÑ', 'success');
                }
            }
        });

        // Make task items draggable
        const observer = new MutationObserver(() => {
            document.querySelectorAll('.task-item').forEach(item => {
                item.draggable = true;
            });
        });

        observer.observe(document.getElementById('taskList'), { childList: true });

        console.log('üçÖ FocusFlow Pomodoro Timer initialized successfully!');
        console.log('Built with modern JavaScript ES6+ features');
        console.log('Features: Task Management, Progress Tracking, Data Export/Import, Keyboard Shortcuts, Drag & Drop');
    </script>
</body>
</html>